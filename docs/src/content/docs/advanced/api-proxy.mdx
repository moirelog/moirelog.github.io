---
title: API 加速
description: 为中国大陆用户配置 GitHub API 代理
---

import { Steps, LinkButton } from '@astrojs/starlight/components';

如果你在中国大陆，访问 GitHub API 可能会遇到速度慢或连接失败的问题。本章介绍如何使用 Cloudflare Workers 搭建代理。

## 为什么需要代理？

快捷指令需要调用 GitHub API 来上传笔记，但在某些网络环境下：

- 请求超时
- 速度极慢

通过 Cloudflare Workers 代理，可以大幅提升速度和稳定性。

## 部署 Cloudflare Workers

### 前置要求

- Cloudflare 账号（免费）
- 自己的域名（**需要**，因为 `workers.dev` 域名也无法访问了）
- 域名已托管到 Cloudflare

我们提供了一键部署按钮（基于独立仓库 [github-api-proxy](https://github.com/moirelog/github-api-proxy)）：

<LinkButton href="https://deploy.workers.cloudflare.com/?url=https://github.com/moirelog/github-api-proxy" variant="secondary" icon="rocket">
  一键部署到 Cloudflare Workers
</LinkButton>

### 手动部署

如果你想自定义代码，可以克隆我们的 worker 仓库进行部署：

<Steps>

1. 确保安装了 Node.js
2. 克隆仓库并部署：
   ```bash
   git clone https://github.com/moirelog/github-api-proxy.git
   cd github-api-proxy
   npm install
   npx wrangler deploy
   ```
3. 根据提示登录 Cloudflare 账号并确认部署。

</Steps>

### 获取 Worker URL

部署成功后，你会得到一个 URL，例如 `https://github-api-proxy.YOUR_SUBDOMAIN.workers.dev`。


### 绑定自定义域名

<Steps>
1. 在 Worker 页面，点击 **Settings**
2. 点击 **Domains & Routes** 标题旁边的 **Add**
3. 选择 **Custom Domain**
4. 输入你的子域名（如 `api.yourdomain.com`）
5. 点击 **Add Custom Domain**
</Steps>

现在，你的 Worker URL 就是：

```
https://api.yourdomain.com
```

复制这个自定义域名 URL，稍后会用到。

## 配置快捷指令

现在需要修改 Moire Config，让它使用你的代理。

<Steps>

1. 打开「快捷指令」App

2. 找到 **Moire Config**

3. 点击右上角的 **...** → **编辑**

4. 找到 **API Base URL** 变量（通常在顶部）

5. 将默认值 `https://api.github.com` 改为你的自定义域名 URL：
   ```
   https://api.yourdomain.com
   ```

6. 点击 **完成**

7. 重新运行一次 **Moire Config** 来保存配置

</Steps>

## 测试代理

配置完成后，测试一下：

在 Moire 文件夹写一篇测试笔记，关闭备忘录或 `Ctrl + S` 触发同步，如果成功，说明代理工作正常


## 故障排查

### Workers 部署失败？

- 确保 Cloudflare 账号已验证邮箱
- 免费计划有每日 100,000 请求限制（对个人博客完全够用）

### 快捷指令仍然失败？

- 检查 Moire Config 中的 proxy URL 是否正确填写
- 确保 URL 没有多余的 `/` 结尾
- **关键**：确保你使用了自定义域名，而不是 `workers.dev` 域名
- 尝试在浏览器访问 Worker URL，看是否返回 404

## 下一步

如果你想使用自定义域名展示博客。

import { LinkCard } from '@astrojs/starlight/components';

<LinkCard
  title="自定义域名"
  description="绑定你自己的域名"
  href="/advanced/custom-domain/"
/>
