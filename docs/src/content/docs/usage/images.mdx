---
title: 图片上传机制
description: 了解 Moire 如何处理图片上传及其限制
---
import { Steps } from '@astrojs/starlight/components';

Moire 支持在笔记中插入图片，但为了保证稳定性，有一些重要限制。

## 重要限制

:::danger[每次同步仅支持 1 张图片]
Moire Sync 快捷指令每次运行时，只会上传笔记中的**第一张**图片。

这是为了保证快捷指令运行速度和稳定性。
:::

## 工作原理

当你在备忘录中插入图片并同步时：

<Steps>
1. 快捷指令提取笔记中的第一张图片
2. 将图片转为 Base64 编码
3. 上传到 GitHub 仓库的 `/public/memos/images/` 目录
4. 在 Markdown 中自动插入图片链接
</Steps>

## 使用建议

### ✅ 推荐做法

- **每篇笔记最多 1 张图片**
- 图片作为封面或关键配图
- 图片大小控制在 1MB 以内

### ❌ 不推荐

- 插入多张图片（只会上传第一张，其他会丢失）
- 上传超大图片（可能导致同步失败）
- 依赖图片展示核心内容（可能加载慢）

## 图片格式

支持的格式：
- ✅ PNG
- ✅ JPG / JPEG
- ✅ GIF
- ✅ WebP

## 图片命名

上传后的图片会自动命名为：

```
[file-hash].png
```


## 故障排查

### 图片没有上传？

可能的原因：

| 问题 | 解决方案 |
|------|----------|
| 图片太大 | 压缩图片或使用体积更小的格式 |
| 网络超时 | 检查网络连接，重试同步 |
| Token 权限不足 | 确保 Token 有 Contents: Read/Write 权限 |
| 不支持的格式 | 使用 PNG 或 JPG |

### 图片显示错误？

检查：
- GitHub Actions 是否构建成功
- 图片是否正确上传到 `/src/memos/images/`
- Markdown 中的图片路径是否正确

## 多图片需求？

如果你需要在一篇文章中使用多张图片，有以下替代方案：

### 方案 1: 制作拼图

将多张图片拼接成一张，再上传。

**优点**：仍然只上传 1 张  
**缺点**：需要额外工具处理

### 方案 2: 手动上传

1. 将图片手动上传到仓库的 `/public/memos/images/`
2. 在笔记中使用相对路径引用

**优点**：完全控制  
**缺点**：失去了快捷指令的便利性



## 下一步

如果你在中国大陆，可能需要配置 API 加速。

import { LinkCard } from '@astrojs/starlight/components';

<LinkCard
  title="API 加速"
  description="为中国大陆用户配置 Cloudflare Workers 代理"
  href="/advanced/api-proxy/"
/>
